<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tarefas Di√°rias</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f3f4f6, #e0f2fe);
      color: #1e293b;
      display: flex;
      justify-content: center;
      padding: 40px;
      margin: 0;
    }
    .app { width: min(950px, 100%); }
    .hero {
      display: flex; justify-content: space-between; align-items: center;
      padding: 24px; border-radius: 20px;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(16px);
      box-shadow: 0 6px 24px rgba(0,0,0,0.08);
      margin-bottom: 24px;
    }
    .logo {
      width: 48px; height: 48px; border-radius: 14px; display: grid; place-items: center;
      background: linear-gradient(135deg,#2563eb,#10b981);
      color:#fff; font-weight:700; font-size:22px;
      box-shadow:0 4px 10px rgba(37,99,235,0.4);
    }
    .controls {
      display: flex; flex-wrap: wrap; gap: 12px;
      padding: 20px; border-radius: 20px;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(14px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }
    input, select, button {
      border: none; padding: 12px 18px;
      border-radius: 12px; font-size: 14px;
    }
    button {
      background:#2563eb; color:#fff; cursor:pointer;
      font-weight:600; border-radius:9999px;
      transition:0.3s;
    }
    button:hover { filter:brightness(1.1); transform:translateY(-1px); }
    .filters { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:16px; }
    .chip {
      padding: 8px 18px;
      border-radius: 999px;
      background: #e5e7eb;
      color: #374151;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: 0.3s;
      border: 1px solid #d1d5db;
    }
    .chip:hover {
      background: #dbeafe;
      color: #2563eb;
    }
    .chip.active {
      background: #2563eb;
      color: #fff;
      font-weight: 600;
      border: none;
    }
    ul#list { list-style:none; display:grid; gap:12px; padding:0; margin:0; }
    .item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px; border-radius: 16px;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 14px rgba(0,0,0,0.06);
      gap: 16px;
      border-left: 6px solid transparent;
    }
    .done .title-text { text-decoration: line-through; opacity:.6; }
    .title-text { font-weight:500; font-size:15px; flex:1; }
    .left-meta {
      display: flex; flex-direction: column; align-items: flex-start;
      min-width: 90px; font-size: 13px; font-weight: 600;
    }
    .task-time { color: #2563eb; }
    .task-prio {
      font-size: 12px; margin-top: 4px; padding: 2px 8px;
      border-radius: 8px; text-transform: capitalize;
    }
    .task-prio.normal { background:#dbeafe; color:#1e3a8a; }
    .task-prio.baixa { background:#f3f4f6; color:#4b5563; }
    .task-prio.alta { background:#fee2e2; color:#b91c1c; font-weight:700; }
    .item.alta { border-left-color: #ef4444; }
    .actions button {
      background:transparent; border:1px solid #2563eb; color:#2563eb;
      padding:6px 12px; border-radius:8px; transition:.2s;
    }
    .actions button:hover { background:#2563eb; color:#fff; }
    footer {
      display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px;
      margin-top:20px; padding:16px;
      background:rgba(255,255,255,0.7);
      backdrop-filter:blur(12px);
      border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.05);
    }
    .empty { text-align:center; padding:20px; font-size:14px; color:#94a3b8; }
  </style>
</head>
<body>
  <div class="app">
    <div class="hero">
      <div class="brand">
        <div class="logo">‚úì</div>
        <div>
          <h1>Tarefas Di√°rias</h1>
          <small id="todayLabel"></small>
        </div>
      </div>
    </div>

    <div class="controls">
      <input type="date" id="datePicker">
      <button id="btnHoje">Hoje</button>
      <input type="time" id="timeInput">
      <input type="text" id="taskInput" placeholder="Nova tarefa">
      <select id="prio">
        <option value="normal">Prioridade: Normal</option>
        <option value="alta">Prioridade: Alta</option>
        <option value="baixa">Prioridade: Baixa</option>
      </select>
      <button id="addBtn">Adicionar</button>
    </div>

    <main>
      <div class="filters">
        <button class="chip active" data-filter="todas">Todas</button>
        <button class="chip" data-filter="pendentes">Pendentes</button>
        <button class="chip" data-filter="concluidas">Conclu√≠das</button>
        <button class="chip" data-filter="alta">Alta</button>
      </div>
      <div class="counters">
        <span id="countPend">Pendentes: 0</span> ‚Ä¢ <span id="countAll">Total: 0</span>
      </div>
      <ul id="list"></ul>
      <div class="empty" id="empty">Nenhuma tarefa.</div>
      <footer>
        <div><button id="clearDone">Limpar conclu√≠das</button></div>
        <div>
          <button class="btn-danger" id="clearDay" style="background:#ef4444;color:#fff">Apagar dia</button>
        </div>
      </footer>
    </main>
  </div>

  <!-- Template -->
  <template id="itemTmpl">
    <li class="item">
      <input type="checkbox" class="chk">
      <div class="left-meta">
        <span class="task-time"></span>
        <span class="task-prio"></span>
      </div>
      <div class="title-text"></div>
      <div class="actions">
        <button class="editBtn">Editar</button>
        <button class="delBtn">Excluir</button>
      </div>
    </li>
  </template>

  <script>
    // üîë Configura√ß√£o Supabase
    const SUPABASE_URL = "https://dylziaqkyavkfwjepqkp.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5bHppYXFreWF2a2Z3amVwcWtwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NTc1OTgsImV4cCI6MjA2ODAzMzU5OH0.gy5jXxKOTgeCf0Rwq7ktLTz1pyoZ8dJjZOK9UB9rHCM";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const state = { tasks:[], filter:'todas', date:new Date() }
    const el = {
      list: document.getElementById('list'),
      empty: document.getElementById('empty'),
      taskInput: document.getElementById('taskInput'),
      timeInput: document.getElementById('timeInput'),
      prio: document.getElementById('prio'),
      addBtn: document.getElementById('addBtn'),
      chips: Array.from(document.querySelectorAll('.chip')),
      countAll: document.getElementById('countAll'),
      countPend: document.getElementById('countPend'),
      clearDone: document.getElementById('clearDone'),
      clearDay: document.getElementById('clearDay'),
      tmpl: document.getElementById('itemTmpl'),
      datePicker: document.getElementById('datePicker'),
      todayLabel: document.getElementById('todayLabel')
    }

    const fmtKey = d => d.toISOString().slice(0,10);
    const fmtBR = d => d.toLocaleDateString('pt-BR',{weekday:'long',day:'2-digit',month:'long',year:'numeric'});

    async function load(){
      const { data, error } = await supabase
        .from('tasks')
        .select('*')
        .eq('date', fmtKey(state.date))
        .order('created_at',{ascending:true});
      if(error) console.error("Erro load:", error);
      state.tasks = data || [];
      render();
    }

    async function add(){
      const text = el.taskInput.value.trim();
      if(!text) return;
      const task = {
        text,
        time: el.timeInput.value || null,
        prio: el.prio.value,
        done: false,
        date: fmtKey(state.date)
      };
      const { data, error } = await supabase.from('tasks').insert([task]).select();
      if(error){ console.error("Erro insert:", error); return; }
      state.tasks.push(data[0]);
      el.taskInput.value=""; el.timeInput.value="";
      render();
    }

    async function toggleDone(task){
      const { error } = await supabase.from('tasks').update({done:!task.done}).eq('id',task.id);
      if(error) console.error("Erro update:", error);
      task.done=!task.done; render();
    }

    async function remove(task){
      const { error } = await supabase.from('tasks').delete().eq('id',task.id);
      if(error) console.error("Erro delete:", error);
      state.tasks=state.tasks.filter(t=>t.id!==task.id);
      render();
    }

    async function edit(task){
      const txt=prompt("Editar:",task.text);
      if(txt){
        const { error } = await supabase.from('tasks').update({text:txt}).eq('id',task.id);
        if(error) console.error("Erro edit:", error);
        task.text=txt; render();
      }
    }

    async function clearDone(){
      const ids=state.tasks.filter(t=>t.done).map(t=>t.id);
      if(ids.length){
        await supabase.from('tasks').delete().in('id',ids);
        state.tasks=state.tasks.filter(t=>!t.done); render();
      }
    }

    async function clearDay(){
      if(confirm("Apagar todas?")){
        await supabase.from('tasks').delete().eq('date',fmtKey(state.date));
        state.tasks=[]; render();
      }
    }

    function render(){
      el.todayLabel.textContent=fmtBR(state.date);
      el.datePicker.value=fmtKey(state.date);
      let view=[...state.tasks];
      if(state.filter==='pendentes') view=view.filter(t=>!t.done);
      if(state.filter==='concluidas') view=view.filter(t=>t.done);
      if(state.filter==='alta') view=view.filter(t=>t.prio==='alta');

      el.countAll.textContent=`Total: ${state.tasks.length}`;
      el.countPend.textContent=`Pendentes: ${state.tasks.filter(t=>!t.done).length}`;
      el.list.innerHTML="";
      if(view.length===0) el.empty.style.display="block"; else el.empty.style.display="none";

      view.forEach(task=>{
        const li=el.tmpl.content.firstElementChild.cloneNode(true);
        li.querySelector('.chk').checked=task.done;
        li.querySelector('.title-text').textContent=task.text;
        li.querySelector('.task-time').textContent = task.time ? `‚è∞ ${task.time}` : "";
        const prioEl = li.querySelector('.task-prio');
        prioEl.textContent = task.prio;
        prioEl.classList.add(task.prio);
        if(task.prio === "alta") li.classList.add("alta");
        if(task.done) li.classList.add('done');
        li.querySelector('.chk').addEventListener('change',()=>toggleDone(task));
        li.querySelector('.delBtn').addEventListener('click',()=>remove(task));
        li.querySelector('.editBtn').addEventListener('click',()=>edit(task));
        el.list.appendChild(li);
      });
      el.chips.forEach(c=>c.classList.toggle('active',c.dataset.filter===state.filter));
    }

    // Eventos
    el.addBtn.addEventListener('click',add);
    el.taskInput.addEventListener('keydown',e=>{if(e.key==="Enter") add()});
    el.clearDone.addEventListener('click',clearDone);
    el.clearDay.addEventListener('click',clearDay);
    el.chips.forEach(c=>c.addEventListener('click',()=>{state.filter=c.dataset.filter;render()}));
    el.datePicker.addEventListener('change',e=>{state.date=new Date(e.target.value);load();});
    document.getElementById('btnHoje').addEventListener('click',()=>{state.date=new Date();load();});

    load();
  </script>
</body>
</html>


</script>

</body>
</html>


